**什麼是1588v2 ？**

  

對於無線通訊來說，時鐘同步至關重要，是基地台正常運作的必要條件。如果同步有問題，輕則切換成功率降低，重則系統無法運作。

  

自3G/4G以來，隨著連接基地台和控制器，核心網路的傳輸網路的逐漸IP化，傳統的TDM（時分複用，例如SDH等技術）網路承載的時脈功能，也必須在新的分組交換網中得以解決。  

  

其實，在IT業界，這個問題早乙太網路的發展初期就被提了出來。  

  

1985年，乙太網路被 IEEE （I nstitu te of Electrical and Electronics Engineers，電氣和電子工程師協會） 標準化為802.3協定；十年之後的1995年，乙太網路的資料傳輸速率從10Mbps提高到了100Mbps，在此過程中， 计算机和网络业界也在致力于解决以電腦和網路業界也在致力於解決乙太網路 的定時 同步能力 不足的問題。

  

於是，IEEE便著手製定進行基於分組交換的精密時鐘同步標準。  

  

2000年底，網路精密時鐘同步委員會成立。

  

2002年底，該委員會制定的同步標準獲得IEEE標準委員會的認證，IEEE1588標準誕生，第一個版本稱為1588v1。

  

2008年初，IEEE組織對1588進行了修訂並重新發布，這個版本就是目前正在廣泛使用的1588v2， 可以 提供小於100ns的時間同步精度 。

  

IEEE 1588的全名是“IEEE P1588 DM2.2， Standard for a Precision Clock Synchronization Protocol for Networked Measurement and Control Systems”，翻譯為中文就是：“網路測量和控制系統的精密時鐘同步協議”。因此1588協定也被簡稱為PTP（ Precise Time Protocol ）協定。

  

1588協定的基本構思是透過軟硬體配合，記錄同步時鐘資訊的發出時間和接收時間，並為每個資訊加上時間標籤。有了時間記錄，接收方就可以計算出自己在網路中的時鐘誤差和延遲，經過修正之後，就可以實現和網路時鐘來源同步的目的。

  

![[155023a05604ca2cad284a84861f7898_MD5.png]]

1588v2組網拓撲  

  

  

  

**_2_**

  

**1588v2 怎樣實現時鐘同步？**

  

在這樣一個複雜的同步網路中，1588主時鐘（Master）和從時鐘（Slave）主要靠傳遞Sync，Follow_Up，Delay_Req，以及Delay_Resp這幾條訊息來實現同步的。  

  

  

![[839bb4dbb32393ea11c9964ad3ea4781_MD5.png]]

1588v2主從時鐘間傳遞的報文

  

1588v2的時鐘具體的同步原理如下圖所示：  

  

![[50dad6b8ab8adfca8e8826609dcd667b_MD5.png]]

1588v2時鐘同步原理

  

1.主時鐘向從時鐘發出Sync報文，並攜帶自身的時鐘t1；  

  

2、從時鐘收到Sync報文，並標註上該時刻自己的時鐘t2；  

  

3.從時鐘向主時鐘發送Delay_Req報文，並攜帶該時刻自身的時鐘t3；  

  

4.主時鐘收到Delay_Req報文，並註上該時刻自己的時鐘t4；

  

5.主時鐘向從時鐘發送Delay_Resp封包，並攜帶時鐘t4；

  

6.假設從時鐘和主時鐘兩者之間的差值為偏移量offset，主時鐘到從時鐘的傳輸時延為t_ms，從時鐘到主時鐘的傳輸時延為t_sm，則有下面兩個等式：

  

**t2 － t1= t_ms + 偏移量  
**

**t4 － t3= t_sm － 偏移量**

假設雙向時延相同，即：delay = t_ms = t_sm，則可以算出以下結果：  

  

**偏移 = ( ( t2 - t1 ) - ( t4 - t3 ) ) / 2  
**

**延遲 = ( ( t2 - t1 ) + ( t4 - t3 ) ) / 2**

  

有了上述計算結果，然後就可以根據偏移量offset來修正從時鐘，就可以實現同步。  

  

要注意的是，上述結果存在一個假設，那就是上下行的時延delay是一樣的，且不同報文間的時延也是相同的。

  

1588v2主要支援以下3種時鐘類型：普通時鐘（Ordinary Clock，OC），邊界時鐘（Boundary Clock， BC），透明時鐘（Transparent Clock，TC）。 其中 透明時鐘又可分為E2E（End to End）透明時鐘，也叫E2E-TC； 以及P2P（Pear to Pear）透明時鐘，也叫P2P-TC。

  

![[8e15b980e9b60b4f3afdb239a8074126_MD5.jpg]]

1588v2支援的時鐘類型

  

**1.普通時鐘（Ordinary Clock，OC）**  

在一個域中，維護著域內所使用的時標，且只有一個PTP連接埠的時脈。普通時鐘要麼作為主時鐘提供時鐘源，要麼作為最末一級終端，從其他的時鐘源獲取時鐘，而不能作為中間節點把時鐘向其他節點傳遞。  

  

![[3e0d2fa064cf7c5097f656b61e0af975_MD5.png]]

1588v2普通時脈架構

  

**2、邊界時鐘（Boundary Clock，BC）**  

邊界時鐘有多個PTP實體通訊埠和網路相連，其每個PTP埠和普通時鐘的PTP埠是一樣的，其中的一個埠在收到上級時脈來源的PTP封包後進行終結，然後再產生新的PTP封包並向下傳遞。  

  

![[e614d477f3643e8bb2d1cd5f538d625c_MD5.png]]

1588v2 邊界時脈架構

  

**3. 透明時鐘（Transparent Clock，TC）**

透明時鐘作為中間節點，收到PTP封包之後不進行終結，其內部有一個駐留時間橋來計算封包在本節點的駐留時間，並以此來修正時間標籤再向下傳遞。  

  

![[bf6adf4984fe7ff79e42ca7fc5290893_MD5.png]]

1588v2透明 時鐘

  

透明時鐘可分為 E2E （End to End ） 透明時鐘，以及P2P（Peer to Peer）透明時鐘。兩者對於PTP封包時延的修正和處理方法不同，在其他方面是完全一樣的。  

  

![[f9452f41d31dde9d8f7107f00189b35c_MD5.png]]

端對端TC

  

E2E 透明 修正只包含本節點駐留的時間，而P2P透明時脈對時延 時脈對時延的 的修正除了包含 本節點駐留的時間 之外，還增加了傳輸路徑上的延遲。

  

![[534fddd4f5a761e9af57c85b39c70562_MD5.png]]

P2P-TC

  

除了上述的幾種時鐘之外，1588v2也定義了管理節點。 管理節點負責處理PTP管理封包，有一個或多個實體介面連接網絡，可以和任意的時鐘類型組合在一起工作。  

  

  

**_3_**

  

**1588v2 有哪些應用場景？**

  

IEEE 1588獨立於物理層，可透過在封包中加入時間標籤來傳遞同步訊息，因此除了頻率同步之外還可以實現時間同步。但在實際應用上由於會受到網路狀態的影響，延時，丟包等都會影響到精確度，所以透過交換網路來傳輸時鐘有較多限制。

  

**1.全網支援1588v2功能（FTS）**

全網支援1588v2功能（FTS，Full Timing Support），是指主時鐘和從時鐘之間的所有傳輸設備都支援1588功能，包括邊界時鐘（BC模式）和透傳時鐘（TC模式）兩種模式。它們的物理拓撲基本上相同，僅在PTP協定的處理機制上有所差異。

  

邊界時鐘模式（BC模式）下的網路中間節點設備有多個1588端口，其中一個端口作為從時鐘和上級時鐘保持同步，其他端口則作為下一級網元的主時鐘。設備收到1588v2封包之後進行終結，然後產生新的封包再向下游傳遞。

  

![[a388ff8127a7626308d5cd4f1beacfe6_MD5.png]]

普通時脈（OC）+邊界時脈（BC）群組網

  

透傳時鐘（TC模式）下的網路節點設備接收到來自時鐘來源的1588v2封包之後不進行終結，而是根據封包的駐留時間和連結時延，修正封包的時間戳訊息，並將其傳送給下游設備。  

  

![[4d58216a9e54849089a80691a64e1d3f_MD5.png]]

普通時鐘（OC ） + 透明時鐘（TC ） 群組網

  

在邊界時鐘模式下，由於分組網路的不穩定性，中間節點不可能百分之百地恢復原始時鐘，而是存在或多或少的誤差，這樣傳遞給下游的時鐘就產生了漂移，並且這樣的漂移還會隨著跳數的增加而不斷累積。而 透傳時鐘 模式下，中間節點只修正時延，對跳數並不敏感，故其理論上的精確度高於邊界時鐘。

  

然而在實際使用中，由於 邊界時鐘模式下 的漂移是不定向的，可能不斷累積增大，也可能多個節點之間產生的漂移可能相互抵消，所以實際上兩種模式的精度相當。

  

**2、1588v2 ATR（Auto Timing Recovery，自動定時恢復）**

對於第一點全網所有傳輸節點都支援1588v2協定的場景，畢竟是理想情況，現實總是和理想有所差距的。 如果主時脈和從時脈之間的傳輸節點不支援1588v2協議，還能如何實現頻率同步和相位同步嗎？  

  

答案是，可以。但傳輸網中的時延，抖動，丟包都會影響時鐘精度，只能用於傳輸負載較小，主從時鐘之間的跳數較少的非常有限的場景。  

  

**3.1588v2同步是否可以用於5G？**

理論上來說，1588v2可支援高精度的相位同步，基本上能夠滿足5G的同步需求。

  

但實際上，分組傳輸網路需要所有節點都支援PTP協議，組網較為複雜，網路的擁塞， 時延， 抖動，丟包都會影響時脈精確度 。更为重要的是，1588v2同步需要上下行链路的时延相等，否 。更重要的是，1588v2同步需要上下行鏈路的時延相等，否則就需要人工校準，這一點在專案實施上非常困難。  

  

因此，5G網路主流的同步方式是GPS或是北斗這樣的GNSS系統。

  

好了，本期的內容就到這裡，希望對大家有幫助。