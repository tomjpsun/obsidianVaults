
**一、應用背景**

在通信網路中，許多業務（例如無線基站領域和工業自動化控制領域）的正常運行都要求網路（時鐘同步]（https://so.csdn.net/so/search?q=%E6%97%B6%E9%92%9F%E5%90%8C%E6%AD%A5&spm=1001.2101.3001.7020）， 或者整個網路各設備之間的時間或頻率差保持在合理的誤差水準內。 網路時鐘同步包括以下兩個概念：

**時間同步：**也叫相位同步，是指信號之間的頻率和相位都保持一致，即信號之間的相位差恆為零。

**頻率同步**：也叫時鐘同步，是指信號之間在頻率或相位上保持某種嚴格的特定關係，信號在其對應的有效瞬間以同一平均速率出現，以保證通信網路中的所有設備都以相同的速率運行，即信號之間保持恆定的相位差。

![[Pasted image 20240515092023.png]] 如上圖，有兩個時鐘A和B，如果這兩個時鐘的時間每時每刻都保持一致，這個狀態就是[時間同步]（https://so.csdn.net/so/search?q=%E6%97%B6%E9%97%B4%E5%90%8C%E6%AD%A5&spm=1001.2101.3001.7020）; 如果這兩個表的時間不一致，但保持一個恆定的差值，這個狀態就是頻率同步。

**二、什麼是PTP**

PTP（Precision Time Protocol，精確時間協定）是一種時間同步的協定，遵循IEEE1588v2協定標準，用於設備之間的高精度時間同步，相比現有的各種時間同步機制，PTP具備以下優勢：

（1）相比NTP（Network Time Protocol，網路時間協定），PTP能夠滿足更高精度的時間同步要求：**NTP一般只能達到亞秒級的時間同步精度，而PTP則可達到亞微秒級**。

（2）相比GPS（Global Positioning System，全球定位系統），**PTP具備更低的建設和維護成本，並且由於可以擺脫對GPS的依賴，在國家安全方面也具備特殊的意義**。

**三、PTP基本概念**

**1**.基本原理

PTP協議在系統內的時鐘間建立主從體系，系統內時鐘的時間都來源於最佳主時鐘（Master）。 最佳主時鐘與從時鐘（Slave）交換PTP報文，從時鐘通過PTP報文中攜帶的時間戳資訊計算與主時鐘之間的時鐘偏差和網路延時，從而實現同步。

**2**.時鐘節點

PTP域中的節點稱為時鐘節點，PTP協定定義了以下三種類型的基本時鐘節點：

![[Pasted image 20240515092112.png]]說明：

（1）BC和TC一般是路由或交換機等轉發設備，OC一般是需要時鐘同步的終端設備，比如PLC、雷達、基站等;

（2）TC包括兩種類型：E2ETC（End-to-End Transparent Clock，端到端透明時鐘）和P2PTC（Peer-to-Peer Transparent Clock，點到點透明時鐘）

**3**.PTP埠

我們將設備上運行了PTP協定的埠稱為PTP埠，可分為以下三種：
![[Pasted image 20240515092133.png]]

![[Pasted image 20240515092145.png]]

![[Pasted image 20240515092154.png]]

**四、PTP配置方法**

設定前需要確認以下資訊：

**1. 確認需要時間同步的設備是否支援PTP協定**

這裡需要注意，普通的電腦、手機等終端一般是使用NTP協定同步時間的，不是用的PTP協定，所以不能通過配置PTP來達到精確同步時間的效果。 只有確定設備支援PTP協定，才能配置使用此功能。


**2. 確認設備支援的PTP協定是基於二層的還是基於三層的**

只有協定層級匹配才能正常使用，目前TP-LINK交換機——TL-SG5412工業級僅支持基於二層的PTP協定，如果設備支援的是基於三層的PTP協定，則無法使用該交換機的PTP功能。 目前TP-LINK暫時沒有支援三層PTP協定的交換機。

**3. 確認交換機是工作在BC（邊界時鐘）模式還是TC（透明時鐘）模式**

如果只需要2個設備經過交換機后能夠使用PTP協定精確同步時間，而交換機本身不需要精確同步時間，那麼可以把交換機設置為TC模式;

如果需要設備、交換機都能夠精確同步時間，那麼需要把交換機設置為BC模式。

**4. 確認設備同步時間所採用的模式是E2E還是P2P**

需要把交換機的同步模式與設備設置成一致才能使用。

**5. 確認設備同步時間時的時間戳類型是「單步」還是「雙步」**

需要把交換機的時間戳類型與設備設置成一致才能使用。

在確認完上述資訊后，就可以開始PTP功能的配置了。

以我司TL-SG5412工業級為例，其同步精度可以達到100ns。 其配置方法如下：

1. 登錄交換機頁面，依次點擊【時鐘同步】—【PTP配置】，即可看到PTP相關配置項：
![[Pasted image 20240515092224.png]]

2. 點擊<启用>后，即可根據自己的實際需求來配置相關參數，相關參數說明如下：
! [[Pasted image 20240515092241.png]]

在設置交換機的PTP功能時，一般我們只需要配置上述3種參數，其他參數保持預設即可，然後再使能相應的埠，就完成了PTP的配置。